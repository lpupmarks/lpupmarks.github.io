<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ukulele Note Detector</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        #note {
            font-size: 24px;
            margin-top: 20px;
        }
        #console {
            margin-top: 20px;
            white-space: pre-wrap; /* Preserve whitespace formatting */
            text-align: left;
            display: inline-block;
        }
    </style>
</head>
<body>
    <h1>Ukulele Note Detector</h1>
    <p id="note">Playing: </p>
    <div id="console"></div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const noteElement = document.getElementById('note');
            const consoleElement = document.getElementById('console');

            // Set up audio context
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const analyser = audioContext.createAnalyser();
            const bufferLength = 2048;
            const dataArray = new Uint8Array(bufferLength);
            const scriptProcessor = audioContext.createScriptProcessor(bufferLength, 1, 1);

            function setupMicrophone() {
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(stream => {
                        const source = audioContext.createMediaStreamSource(stream);
                        source.connect(analyser);
                        analyser.connect(scriptProcessor);
                        scriptProcessor.connect(audioContext.destination);

                        scriptProcessor.onaudioprocess = () => {
                            analyser.getByteFrequencyData(dataArray);
                            const frequency = getFrequency(dataArray, audioContext.sampleRate);
                            const note = frequencyToNote(frequency);

                            if (note) {
                                noteElement.textContent = `Playing: ${note} (${frequency.toFixed(2)} Hz)`;
                            } else {
                                noteElement.textContent = 'Playing: No note detected';
                            }

                            const logMessage = `Frequency: ${frequency.toFixed(2)} Hz, Note: ${note}\n`;
                            consoleElement.textContent += logMessage;
                        };
                    })
                    .catch(err => console.error('Error accessing microphone:', err));
            }

            function getFrequency(dataArray, sampleRate) {
                const FFT_SIZE = 2048;
                const buffer = new Float32Array(FFT_SIZE);
                const freqArray = new Uint8Array(FFT_SIZE);
                const maxIndex = dataArray.indexOf(Math.max(...dataArray));
                const frequency = (maxIndex / FFT_SIZE) * sampleRate;
                return frequency;
            }

            function frequencyToNote(frequency) {
                const A4 = 440;
                const notes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
                if (frequency === 0) return null;
                const noteNumber = Math.round(12 * Math.log2(frequency / A4)) + 49;
                return notes[(noteNumber % 12 + 12) % 12];
            }

            setupMicrophone();
        });
    </script>
</body>
</html>
